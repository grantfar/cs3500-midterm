<div> /* </div><br>
<div>  * This program is the main program we will use at FSR. It takes spectrum readings from the spectrometer and saves them to a file with their corresponding wavelengths. </div><br>
<div>  * After these readings are taken, it determines the average spectrum reading and max spectrum reading with its corresponding wavelength. </div><br>
<div>  */ </div><br>
<div>  </div><br>
<div> #include &lt;stdio.h&gt; </div><br>
<div> #include &lt;stdlib.h&gt; </div><br>
<div> #include &lt;string.h&gt; </div><br>
<div> #include &lt;pthread.h&gt; </div><br>
<div> #include &lt;time.h&gt; </div><br>
<div> #include &lt;sys/time.h&gt; </div><br>
<div> #include &lt;errno.h&gt; </div><br>
<div> #include <span class="string">"api/SeaBreezeWrapper.h"</span> </div><br>
<div>  </div><br>
<div> <span class="declare">int</span> main() { </div><br>
<div> 	<span class="declare">char</span> fileName[] = { <span class="string">"spectrum.csv"</span> }; </div><br>
<div> 	 </div><br>
<div> 	<span class="declare">double</span> maxSpec = 0; </div><br>
<div> 	<span class="declare">double</span> avgSpec = 0; </div><br>
<div> 	<span class="declare">double</span> totalSpec = 0; </div><br>
<div> 	<span class="declare">double</span> maxWave = 0; </div><br>
<div>  </div><br>
<div> 	<span class="declare">int</span> errorCode; </div><br>
<div>  </div><br>
<div> 	<span class="declare">int</span> open = <span class="reserved">seabreeze_open_spectrometer</span>(0,&amp;errorCode); //Opens device attached to system <span class="reserved">if</span> there is one </div><br>
<div> 	<span class="reserved">if</span> (open == 1) { //If no device opened, program exits </div><br>
<div> 		<span class="reserved">printf</span>(<span class="string">"--NO SPECTROMETER FOUND--\n"</span>); </div><br>
<div> 		return 0; </div><br>
<div> 	} </div><br>
<div>  </div><br>
<div> 	<span class="declare">char</span> model[16]; </div><br>
<div> 	<span class="declare">int</span> pixels = <span class="reserved">seabreeze_get_formatted_spectrum_length</span>(0, &amp;errorCode); //Acquires a spectrum and returns answer in formatted floats </div><br>
<div>  </div><br>
<div> 	<span class="declare">double</span> *wavelength = (double*) malloc(pixels * <span class="reserved">sizeof</span>(<span class="declare">double</span>)); </div><br>
<div> 	<span class="reserved">seabreeze_get_wavelengths</span>(0,&amp;errorCode,wavelength,pixels); //Computes wavelengths <span class="reserved">for</span> the spectrometer and fills <span class="string">"wavelength" array with those values up to "pixels"</span> value </div><br>
<div>  </div><br>
<div> 	<span class="declare">double</span> *spectrum = (double*) malloc(pixels * <span class="reserved">sizeof</span>(<span class="declare">double</span>)); </div><br>
<div> 	<span class="reserved">seabreeze_get_formatted_spectrum</span>(0,&amp;errorCode,spectrum,pixels); //Acquires the spectrum and returns in formatted floats and places this in the <span class="string">"spectrum" array up to "pixels"</span> value </div><br>
<div>  </div><br>
<div> 	<span class="declare">FILE</span> *csv = fopen(fileName,<span class="string">"w"</span>); </div><br>
<div>  </div><br>
<div> 	<span class="reserved">fprintf</span>(csv, <span class="string">"Wavelength, Spectrum\n"</span>); </div><br>
<div> 	<span class="reserved">for</span>(<span class="declare">int</span> i = 0; i &lt; pixels; i += 5){ </div><br>
<div> 		<span class="reserved">for</span>(<span class="declare">int</span> k = 0; k &lt; 5 &amp;&amp; k+i&lt;pixels; k++){ </div><br>
<div> 			<span class="reserved">fprintf</span>(csv,<span class="string">"%f,%f\n",wavelength[k+i],spectrum[k+i]); //Writes wavelength and spectrum at each pixel to "spectrum.csv"</span> </div><br>
<div> 			totalSpec += spectrum[k+i]; </div><br>
<div> 			<span class="reserved">if</span> (maxSpec &lt; spectrum[k+i] &amp; k + i &gt; 1) { //Sets maxSpec <span class="reserved">if</span> spectrum reading is higher than other specrum readings, skips first two readings because of bad values </div><br>
<div> 				maxSpec = spectrum[k+i]; </div><br>
<div> 				maxWave = wavelength[k+i]; </div><br>
<div> 			} </div><br>
<div> 		} </div><br>
<div> 	} </div><br>
<div>  </div><br>
<div> 	<span class="reserved">printf</span>(<span class="string">"Output written to \"%s\"\n"</span>, fileName); </div><br>
<div>  </div><br>
<div> 	avgSpec = totalSpec/pixels; </div><br>
<div> 	<span class="reserved">printf</span>(<span class="string">"MAX: %f AVG: %f\nWAVELENGTH AT MAX: %f nm\n"</span>, maxSpec, avgSpec, maxWave); </div><br>
<div>  </div><br>
<div> 	<span class="reserved">seabreeze_close_spectrometer</span>(0, &amp;errorCode); //Closes device </div><br>
<div> 	fclose(csv); //Closes spectrum file </div><br>
<div>  </div><br>
<div> 	return 0; </div><br>
<div> } </div><br>
