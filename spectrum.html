<meta  charset="utf-8"><link rel="stylesheet" href="css/code.css">
<code>/*<br>
 * This program is the main program we will use at FSR. It takes spectrum readings from the spectrometer and saves them to a file with their corresponding wavelengths.<br>
 * After these readings are taken, it determines the average spectrum reading and max spectrum reading with its corresponding wavelength.<br>
 */<br>
<br>
#include &lt;stdio.h&gt;<br>
#include &lt;stdlib.h&gt;<br>
#include &lt;string.h&gt;<br>
#include &lt;pthread.h&gt;<br>
#include &lt;time.h&gt;<br>
#include &lt;sys/time.h&gt;<br>
#include &lt;errno.h&gt;<br>
#include <span class="string">"api/SeaBreezeWrapper.h"</span><br>
<br>
<span class="declare">int</span> main() {<br>
	<span class="declare">char</span> fileName[] = { <span class="string">"spectrum.csv"</span> };<br>
	<br>
	<span class="declare">double</span> maxSpec = 0;<br>
	<span class="declare">double</span> avgSpec = 0;<br>
	<span class="declare">double</span> totalSpec = 0;<br>
	<span class="declare">double</span> maxWave = 0;<br>
<br>
	<span class="declare">int</span> errorCode;<br>
<br>
	<span class="declare">int</span> open = <span class="reserved">seabreeze_open_spectrometer</span>(0,&amp;errorCode); //Opens device attached to system <span class="reserved">if</span> there is one<br>
	<span class="reserved">if</span> (open == 1) { //If no device opened, program exits<br>
		<span class="reserved">printf</span>(<span class="string">"--NO SPECTROMETER FOUND--\n"</span>);<br>
		return 0;<br>
	}<br>
<br>
	<span class="declare">char</span> model[16];<br>
	<span class="declare">int</span> pixels = <span class="reserved">seabreeze_get_formatted_spectrum_length</span>(0, &amp;errorCode); //Acquires a spectrum and returns answer in formatted floats<br>
<br>
	<span class="declare">double</span> *wavelength = (double*) malloc(pixels * <span class="reserved">sizeof</span>(<span class="declare">double</span>));<br>
	<span class="reserved">seabreeze_get_wavelengths</span>(0,&amp;errorCode,wavelength,pixels); //Computes wavelengths <span class="reserved">for</span> the spectrometer and fills <span class="string">"wavelength" array with those values up to "pixels"</span> value<br>
<br>
	<span class="declare">double</span> *spectrum = (double*) malloc(pixels * <span class="reserved">sizeof</span>(<span class="declare">double</span>));<br>
	<span class="reserved">seabreeze_get_formatted_spectrum</span>(0,&amp;errorCode,spectrum,pixels); //Acquires the spectrum and returns in formatted floats and places this in the <span class="string">"spectrum" array up to "pixels"</span> value<br>
<br>
	<span class="declare">FILE</span> *csv = fopen(fileName,<span class="string">"w"</span>);<br>
<br>
	<span class="reserved">fprintf</span>(csv, <span class="string">"Wavelength, Spectrum\n"</span>);<br>
	<span class="reserved">for</span>(<span class="declare">int</span> i = 0; i &lt; pixels; i += 5){<br>
		<span class="reserved">for</span>(<span class="declare">int</span> k = 0; k &lt; 5 &amp;&amp; k+i&lt;pixels; k++){<br>
			<span class="reserved">fprintf</span>(csv,<span class="string">"%f,%f\n",wavelength[k+i],spectrum[k+i]); //Writes wavelength and spectrum at each pixel to "spectrum.csv"</span><br>
			totalSpec += spectrum[k+i];<br>
			<span class="reserved">if</span> (maxSpec &lt; spectrum[k+i] &amp; k + i &gt; 1) { //Sets maxSpec <span class="reserved">if</span> spectrum reading is higher than other specrum readings, skips first two readings because of bad values<br>
				maxSpec = spectrum[k+i];<br>
				maxWave = wavelength[k+i];<br>
			}<br>
		}<br>
	}<br>
<br>
	<span class="reserved">printf</span>(<span class="string">"Output written to \"%s\"\n"</span>, fileName);<br>
<br>
	avgSpec = totalSpec/pixels;<br>
	<span class="reserved">printf</span>(<span class="string">"MAX: %f AVG: %f\nWAVELENGTH AT MAX: %f nm\n"</span>, maxSpec, avgSpec, maxWave);<br>
<br>
	<span class="reserved">seabreeze_close_spectrometer</span>(0, &amp;errorCode); //Closes device<br>
	fclose(csv); //Closes spectrum file<br>
<br>
	return 0;<br>
}<br>
</code>